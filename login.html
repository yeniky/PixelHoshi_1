<!doctype html><html lang="es"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ingresar – PixelHoshi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="icon" type="image/svg+xml" href="assets/img/pixelhoshi.svg">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark border-bottom">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">
      <img src="assets/img/pixel_skull_star.svg" alt="PixelHoshi" width="20" height="20" class="me-2 align-text-top">
      PixelHoshi
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navPrincipal" aria-controls="navPrincipal" aria-expanded="false" aria-label="Alternar navegación">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navPrincipal">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="catalogo.html">Juegos</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html">Ingresar</a></li>
        <li class="nav-item"><a class="nav-link" href="register.html">Registrarse</a></li>
        <li class="nav-item"><a class="nav-link" href="profile.html">Perfil</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container py-4" style="max-width:520px;">
  <h1 class="h4 mb-3">Inicio de sesión</h1>
  <form id="formLogin" novalidate class="needs-validation">
    <div class="mb-3">
      <label class="form-label">Email</label>
      <input type="email" id="emailLogin" class="form-control" required>
      <div class="invalid-feedback">Ingresa un email válido.</div>
    </div>
    <div class="mb-3">
      <label class="form-label">Contraseña</label>
      <input type="password" id="passLogin" class="form-control" required minlength="8">
      <div class="invalid-feedback">Ingresa tu contraseña.</div>
    </div>
<button id="btnIngresar" class="btn btn-primary w-100 mb-2" type="button">Ingresar</button>


    <a class="btn btn-link w-100" href="recover.html">¿Olvidaste tu contraseña?</a>
    <div class="mt-3 small text-muted">
      <div class="text-secondary">Admin: admin@pixelhoshi.com / Admin*123</div>
      <div class="text-secondary">Usuario: user@pixelhoshi.com / User*1234</div>
    </div>
  </form>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/auth.js"></script>
<script>
  // ===== Salir
  (function(){
    const btn = document.getElementById('linkSalir');
    if(!btn) return;
    btn.addEventListener('click', function(e){
      e.preventDefault();
      localStorage.removeItem('usuarioActual');
      localStorage.removeItem('rolActual');
      alert('Sesión cerrada.');
      location.href = 'login.html';
    });
  })();
</script>
<script>
// ===== LOGIN
document.addEventListener('DOMContentLoaded', function(){
  const btn  = document.getElementById('btnIngresar');
  const email= document.getElementById('emailLogin');
  const pass = document.getElementById('passLogin');

  if(!btn || !email || !pass){
    alert('No se encontraron elementos del formulario de login. Revisa IDs.');
    return;
  }

  function emailValido(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v||''); }
  function normalizar(v){ return (v||'').toString().trim().toLowerCase(); }

  function asegurarSeeds(){
    let usuarios = [];
    try {
      const raw = localStorage.getItem('usuarios');
      usuarios = raw ? JSON.parse(raw) : [];
      if(!Array.isArray(usuarios)) usuarios = [];
    } catch { usuarios = []; }
    const seeds = [
      { email:'admin@pixelhoshi.com', password:'Admin*123',  rol:'admin'  },
      { email:'user@pixelhoshi.com',  password:'User*1234', rol:'usuario' }
    ];
    let cambió = false;
    seeds.forEach(s=>{
      if(!usuarios.some(u => normalizar(u.email) === normalizar(s.email))){
        usuarios.push(s); cambió = true;
      }
    });
    if(cambió) localStorage.setItem('usuarios', JSON.stringify(usuarios));
    return usuarios;
  }

  btn.addEventListener('click', function(){
   //Ventana emergente
    email.classList.remove('is-invalid','is-valid');
    pass.classList.remove('is-invalid','is-valid');

    let ok = true;
    if(!emailValido(email.value)){ email.classList.add('is-invalid'); ok=false; } else { email.classList.add('is-valid'); }
    if(!pass.value){ pass.classList.add('is-invalid'); ok=false; } else { pass.classList.add('is-valid'); }
    if(!ok){ alert('Revisa los campos marcados en rojo.'); return; }

    const usuarios = asegurarSeeds();
    const e = normalizar(email.value);
    const u = usuarios.find(x => normalizar(x.email) === e);

    if(u && u.password === pass.value){
      localStorage.setItem('usuarioActual', u.email);
      localStorage.setItem('rolActual', u.rol);
      alert('Ingreso correcto');
      location.href = 'catalogo.html';
    } else {
      alert('Credenciales incorrectas');
    }
  });
});
</script>


</body>
</html>
